var __;"undefined"!=typeof wp&&wp.i18n&&void 0===__&&(wp.i18n.setLocaleData({},"webnorthcodechallenge"),__=wp.i18n.__);let LOCAL_STORAGE_KEY="savedStations",getSavedStations=()=>{try{var e=localStorage.getItem(LOCAL_STORAGE_KEY);return e?JSON.parse(e):[]}catch{return[]}},saveStationToLocal=e=>{var t=new Set(getSavedStations());t.add(String(e)),localStorage.setItem(LOCAL_STORAGE_KEY,JSON.stringify([...t]))},removeStationFromLocal=e=>{var t=new Set(getSavedStations());t.delete(String(e)),localStorage.setItem(LOCAL_STORAGE_KEY,JSON.stringify([...t]))},isStationSaved=e=>getSavedStations().includes(String(e)),getWebNorthCodeChallengeSettings=()=>({restUrl:webnorthCodeChallengeSettings?.rest_url??"",nonce:webnorthCodeChallengeSettings?.nonce??""}),renderWeatherData=o=>{let r=document.querySelector("#sidebarCityContent");r&&(r.innerHTML=`
        <div class="loading">
            <div class="loader"></div>
        </div>
    `,requestAnimationFrame(()=>{setTimeout(()=>{r.innerHTML="";var e,t,a=document.createElement("h3");a.textContent=o.title||__("Weather Data","webnorthcodechallenge"),r.appendChild(a);for([e,t]of Object.entries(o.weather.main)){var n=document.createElement("p"),i=e.charAt(0).toUpperCase()+e.slice(1);n.innerHTML=`<span class="fw-600">${i}:</span> `+t,r.appendChild(n)}},300)}))},loadWeatherData=async(e,t="metric")=>{var{restUrl:a,nonce:n}=getWebNorthCodeChallengeSettings();if(!a||!n)return console.error("REST URL or nonce is not defined."),null;try{var i,o=await fetch(a+`weather-station/${e}?units=`+t,{method:"GET",headers:{"Content-Type":"application/json","X-WP-Nonce":n}});if(o.ok)return(i=await o.json())&&i.weather?(renderWeatherData(i),i.weather):(console.warn("No weather data found for station ID:",e),null);throw new Error("HTTP error! status: "+o.status)}catch(e){return console.error("Error fetching weather data:",e),null}},getStationById=(t,e)=>e.find(e=>String(e.id)===String(t)),setupSidebarControls=(e,t)=>{let a=document.querySelector("#celciusBtn"),n=document.querySelector("#fahrenheitBtn"),i=document.querySelector("#saveBtn"),o=async e=>{a.classList.toggle("active","metric"===e),n.classList.toggle("active","imperial"===e),t&&await loadWeatherData(t,e)},r=()=>{i&&(i.classList.toggle("saved",isStationSaved(t)),i.setAttribute("title",isStationSaved(t)?"Unsave":"Save"))};a?.addEventListener("click",()=>o("metric")),n?.addEventListener("click",()=>o("imperial")),i?.addEventListener("click",()=>{(isStationSaved(t)?removeStationFromLocal:saveStationToLocal)(t),r()}),r()},updateSidebar=(e,t,a=0,n="")=>{n&&(window.location.hash="#"+n);var i,o,r,s=document.querySelector("#sidebarContent");s&&(s.innerHTML="",(i=document.createElement("div")).className="sidebar-header",i.setAttribute("data-id",n),(r=document.createElement("div")).className="temp-buttons",r.innerHTML=`
        <button id="celciusBtn" class="active">${__("Celcius","webnorthcodechallenge")} /</button>
        <button id="fahrenheitBtn">&nbsp;${__("Fahrenheit","webnorthcodechallenge")}</button>
    `,(o=document.createElement("button")).id="saveBtn",o.innerHTML=`<svg width="19" height="25" viewBox="0 0 19 25" fill="none" xmlns="http://www.w3.org/2000/svg">
<path fill-rule="evenodd" clip-rule="evenodd" d="M0.53125 2.25L1.8125 0.96875H17.1875L18.4688 2.25V24.9985L9.5 19.6837L0.53125 24.9985V2.25ZM3.09375 3.53125V20.5015L9.5 16.7051L15.9062 20.5015V3.53125H3.09375Z" fill="#EEEEEE"/>
</svg>`,i.appendChild(r),i.appendChild(o),s.appendChild(i),(r=document.createElement("div")).id="sidebarCityContent",s.appendChild(r),setupSidebarControls(i,n))};document.addEventListener("DOMContentLoaded",()=>{if(Array.isArray(webnorthCodeChallengeSettings?.weather_stations)){let p=webnorthCodeChallengeSettings.weather_stations;var e=p[0];let u=L.map("mapWrap").setView([e.lat,e.lng],6),v=(L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a>'}).addTo(u),{});p.forEach(t=>{let a=parseFloat(t.lat),n=parseFloat(t.lng);if(a&&n){let e=L.marker([a,n]).addTo(u).bindPopup(`${__("Latitude","webnorthcodechallenge")}: ${a}<br>`+`${__("Longitude","webnorthcodechallenge")}: ${n}<br>`+t.title);(v[t.id]=e).on("click",async()=>{e.openPopup(),updateSidebar(a,n,t.title,t.id),await loadWeatherData(t.id)})}}),u.on("click",async e=>{var t,a,n,i,o,r,{lat:s,lng:l}=e.latlng;let d=null,c=1/0;for(t of p){a=s,n=l,i=t.lat,o=t.lng,h=r=void 0,h=(r=e=>e*(Math.PI/180))(i-a),o=r(o-n),n=Math.sin(h/2)**2+Math.cos(r(a))*Math.cos(r(i))*Math.sin(o/2)**2;var h=12742*Math.atan2(Math.sqrt(n),Math.sqrt(1-n));h<c&&(c=h,d=t)}d&&(u.setView([d.lat,d.lng],7),v[d.id]?.openPopup(),updateSidebar(d.lat,d.lng,d.title,d.id),await loadWeatherData(d.id))});e=async()=>{var e,t=window.location.hash.replace("#","");t&&(t=getStationById(t,p))&&((e=document.getElementById("mapWrap"))&&e.scrollIntoView({behavior:"smooth"}),u.setView([t.lat,t.lng],7),v[t.id]?.openPopup(),updateSidebar(t.lat,t.lng,t.title,t.id),await loadWeatherData(t.id))};window.addEventListener("hashchange",e),e()}else console.warn("No weather stations data found.")}),document.addEventListener("DOMContentLoaded",function(){let t=document.querySelector(".sidebar");var e=document.getElementById("scroll-trigger"),e=(new IntersectionObserver(e=>{e[0].isIntersecting?t.classList.add("active"):t.classList.contains("active")&&t.classList.remove("active")},{threshold:.01}).observe(e),document.getElementById("sidebarMobileCurtain"));let a=0;e.addEventListener("touchstart",e=>{a=e.touches[0].clientY}),e.addEventListener("touchend",e=>{e=e.changedTouches[0].clientY-a;e<-30?t.classList.contains("close")?t.classList.remove("close"):t.classList.add("open"):30<e&&(t.classList.contains("open")?t.classList.remove("open"):t.classList.add("close"))}),(()=>{let i=CSS.supports("animation-timeline","scroll()"),o=new Map,t=!1,s=(e,t,a)=>e+(t-e)*a,l=e=>{var t=parseFloat(e);return{val:t,unit:e.replace(t,"")}},r=()=>{let e=Math.min(1,window.scrollY/(document.body.scrollHeight-window.innerHeight));o.forEach(({el:n,frames:t})=>{var a=100*e;let[i,o]=[t[0],t[t.length-1]];for(let e=0;e<t.length-1;e++)if(a>=t[e].p&&a<=t[e+1].p){[i,o]=[t[e],t[e+1]];break}let r=i.p===o.p?0:(a-i.p)/(o.p-i.p);Object.keys(i.styles).forEach(e=>{var t=l(i.styles[e]),a=l(o.styles[e]||i.styles[e]);"opacity"===e?n.style.opacity=s(t.val,a.val,r):"visibility"===e?(console.log(r),n.style.visibility=.99<r?"hidden":"visible"):t.unit===a.unit&&(n.style[e]=s(t.val,a.val,r)+t.unit)})}),t=!1};return i||addEventListener("scroll",()=>{t||(requestAnimationFrame(r),t=!0)},{passive:!0}),(e,t)=>{var a,n;i?(n=`@keyframes ${a="sa"+Math.random().toString(36).slice(2,8)}{${Object.entries(t).map(([e,t])=>`${e}{${Object.entries(t).map(([e,t])=>e+":"+t).join(";")}}`).join("")}}`,document.head.appendChild(Object.assign(document.createElement("style"),{textContent:n})),Object.assign(e.style,{animationName:a,animationDuration:"auto",animationTimeline:"scroll()"})):(o.set(e,{el:e,frames:Object.entries(t).map(([e,t])=>({p:parseFloat(e),styles:t})).sort((e,t)=>e.p-t.p)}),r())}})()(document.querySelector("header.header"),{"0%":{opacity:"1",visibility:"visible"},"100%":{opacity:"0",visibility:"hidden"}})});